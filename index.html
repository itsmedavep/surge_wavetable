<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Sun Nov 17 2019 00:54:50 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5dd067f0033682898bef3368" data-wf-site="5dd067f003368228cdef3367">
<head>
  <meta charset="utf-8">
  <title>Surge_Wavetable_Editor</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/surge-wavetable-editor.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Inconsolata:400,700"]  }});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  
  <script>
  // Stubbing in everything here. Move this all over to an external file eventually.
    
    // Global variable init
    
    let context = null;
    
    let playButton = null;
    let volumeControl = null;
    
    let oscNode1 = null;
    let oscNode2 = null;
    let oscNode3 = null;
    
    let constantNode = null;
    
    let gainNode1 = null;
    let gainNode2 = null;
    let gainNode3 = null;
    
    let playing = false;
    
   
    
    
    // Now we are setting things up for the osc.
    function setup() {
      
      //Create the context so we get sound and can play things back.
      context = new (window.AudioContext || window.webkitAudioContext)();
      
      //Setting up button and volume control events
      
      playButton = document.querySelector("#playButton");
      volumeControl = document.querySelector("#volumeControl");
      
      playButton.addEventListener("click", togglePlay, false);
      volumeControl.addEventListener("input", changeVolume, false);
      
      //Making it so that I can control the volume of the Oscillators from a single control
      
      gainNode1 = context.createGain();
      gainNode1.gain.value = 0.0;
      gainNode2 = context.createGain();
      gainNode3 = context.createGain();
           
      gainNode1.gain.value = gainNode1.gain.value;
      gainNode2.gain.value = gainNode1.gain.value;
      gainNode3.gain.value = gainNode1.gain.value;
      
      volumeControl.value = gainNode1.gain.value;
      
      //Now for the fun bit. The constant node is the specail sauce for controlling the all at once.
      constantNode = context.createConstantSource();
      constantNode.connect(gainNode1.gain);
      constantNode.connect(gainNode2.gain);
      constantNode.connect(gainNode3.gain);
      constantNode.start();
      
      gainNode1.connect(context.destination);
      gainNode2.connect(context.destination);
      gainNode3.connect(context.destination);
      
  
      
      
      //////////////////////
      //oscilloscope stuff//
      //////////////////////
      
      
      
    const analyser = context.createAnalyser();
      gainNode1.connect(analyser);
      
      const waveform = new Float32Array(analyser.frequencyBinCount);
      analyser.getFloatTimeDomainData(waveform);
      
      function updateWaveform() {
        requestAnimationFrame(updateWaveform);
        analyser.getFloatTimeDomainData(waveform);
      }
         
    analyser.fftSize = 2048;
    var bufferLength = analyser.frequencyBinCount;
    var dataArray = new Uint8Array(bufferLength);
    analyser.getByteTimeDomainData(dataArray);
    
    //Get the canvas by ID
    var canvas = document.getElementById("oscilloscope");
    var canvasCTX = canvas.getContext("2d");
    canvasCTX.clearRect(0,0, canvas.width, canvas.height);
    
    
  
    //draw the oscilloscope already will you
    function draw() {
      
      requestAnimationFrame(draw);
      
      analyser.getByteTimeDomainData(dataArray);
      
      //cavas apperance
      
      //bg stuff
      canvasCTX.fillStyle = "rgb(27,27,27)";
      canvasCTX.fillRect(0,0, canvas.width,canvas.height);
      
      //line stuff
      //255, 144, 0
      canvasCTX.lineWidth = 2;
      canvasCTX.strokeStyle = "rgb(255,144,0)";
      
      canvasCTX.beginPath();
      
      var sliceWidth = canvas.width * 1.0 / bufferLength;
      var x = 0;
      
      for (var i = 0; i < bufferLength; i++) {
        
        var v = dataArray[i] / 128.0;
        var y = v * canvas.height / 2;
        
        if (i === 0) {
          canvasCTX.moveTo(x, y);
        } else {
          canvasCTX.lineTo(x, y)
        }
        
        x += sliceWidth;
        
      }
      canvasCTX.lineTo(canvas.width, canvas.height / 2);
      canvasCTX.stroke();
    }
    
    draw();
     
    }
    
    //setting up load handler on the setup function
    
    window.addEventListener("load", setup, false);
    
    //now for ze toggle. So check to see if playing and if so stop, if not play.
    function togglePlay(event) {
      if (playing) {
        playButton.innerHTML = "⏸";
        stopOscillators();
      } else {
        playButton.innerHTML = "▶️";
        startOscillators();
      }
    }
    
    //control the osc volume
    function changeVolume(event) {
      constantNode.offset.value = volumeControl.value;
    }
    
    //start up the oscillators. Ima have them play a chord.
    function startOscillators() {
      
      //Osc 1 is a sine at C3
      oscNode1 = context.createOscillator();
      oscNode1.type = "sine";
      oscNode1.frequency.value = 261.6255;
      oscNode1.connect(gainNode1);
      
      //Osc 2 is sine at E3
      oscNode2 = context.createOscillator();
      oscNode2.type = "sine";
      oscNode2.frequency.value = 329.6275;
      oscNode2.connect(gainNode2);
      
      //Osc 3 is square at G3
      oscNode3 = context.createOscillator();
      oscNode3.type = "square";
      oscNode3.frequency.value = 391.9954;
      oscNode3.connect(gainNode3);
      
      oscNode1.start();
      oscNode2.start();
      oscNode3.start();
      
      playing = true;     
    }
    
    //Will you stop already....Well, sure.
    function stopOscillators() {
      oscNode1.stop();
      oscNode2.stop();
      oscNode3.stop();
      playing = false;
    }
    
     
  
  </script>

</head>
<body>
  <div class="div-block-7">
    <div class="div-block-8">
      <div class="div-block-10">
        <h4 class="heading">Tool Pallet</h4>
        <div class="controls">
          <div>
            <button id="playButton" class="button" onclick="togglePlay">▶️</button>
          </div>
          <div>
            <span>Volume: </span>
            <input type="range" min="0.0" max="1.0" step="0.01" value="1.0" name="volume" id="volumeControl">
          </div>
        </div>
        
      </div>
      <div class="div-block-11">
        <canvas id="oscilloscope" style="width: 100%; height: 100%"/>
      </div>
    </div>
    <div class="div-block-9">
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
      <div class="div-block-12"></div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js" type="text/javascript" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
 
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>